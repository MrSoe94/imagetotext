<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text Extractor Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .drop-zone {
            border: 2px dashed #cbd5e1;
            transition: all 0.3s ease;
        }
        .drop-zone.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .loader {
            border-top-color: #3b82f6;
            animation: spinner 0.6s linear infinite;
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans">

    <div class="max-w-4xl mx-auto py-12 px-4">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-slate-800 mb-2">AI Text Extractor</h1>
            <p class="text-slate-600 text-lg">Ekstrak teks dari gambar dengan kecerdasan Gemini AI</p>
        </header>

        <main class="grid gap-8">
            <!-- Upload Section -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div id="dropZone" class="drop-zone rounded-xl p-10 text-center cursor-pointer mb-4">
                    <input type="file" id="fileInput" class="hidden" accept="image/*">
                    <div id="previewContainer" class="hidden mb-4">
                        <img id="imagePreview" class="max-h-64 mx-auto rounded-lg shadow-md border">
                    </div>
                    <div id="uploadPrompt">
                        <i class="fas fa-cloud-upload-alt text-4xl text-blue-500 mb-3"></i>
                        <p class="text-slate-700 font-medium">Klik atau seret gambar ke sini</p>
                        <p class="text-slate-400 text-sm mt-1">Mendukung PNG, JPG, JPEG</p>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button id="extractBtn" disabled class="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 text-white font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2">
                        <i class="fas fa-wand-magic-sparkles"></i>
                        Ekstrak Teks
                    </button>
                    <button id="resetBtn" class="bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold py-3 px-6 rounded-xl transition-all">
                        Reset
                    </button>
                </div>
            </div>

            <!-- Result Section -->
            <div id="resultCard" class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-800">Hasil Ekstraksi</h2>
                    <button id="copyBtn" class="text-blue-600 hover:bg-blue-50 px-3 py-1 rounded-lg text-sm font-medium transition-colors">
                        <i class="far fa-copy mr-1"></i> Salin Teks
                    </button>
                </div>
                <div id="loadingState" class="hidden py-10 text-center">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-slate-200 h-12 w-12 mb-4 mx-auto"></div>
                    <p class="text-slate-500 animate-pulse">Menganalisis gambar...</p>
                </div>
                <textarea id="outputText" rows="10" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none font-mono text-sm leading-relaxed"></textarea>
            </div>
        </main>

        <footer class="mt-12 text-center text-slate-400 text-sm">
            <p>Didukung oleh Gemini 2.5 Flash Preview</p>
        </footer>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-5 right-5 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 transition-transform duration-300 flex items-center gap-2">
        <i class="fas fa-check-circle text-green-400"></i>
        <span id="toastMsg">Teks berhasil disalin!</span>
    </div>

    <script>
        const apiKey = ""; // Dikelola oleh lingkungan runtime
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const uploadPrompt = document.getElementById('uploadPrompt');
        const extractBtn = document.getElementById('extractBtn');
        const resetBtn = document.getElementById('resetBtn');
        const resultCard = document.getElementById('resultCard');
        const loadingState = document.getElementById('loadingState');
        const outputText = document.getElementById('outputText');
        const copyBtn = document.getElementById('copyBtn');

        let base64Image = null;

        // File Selection Handlers
        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            const file = files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    base64Image = e.target.result.split(',')[1];
                    imagePreview.src = e.target.result;
                    previewContainer.classList.remove('hidden');
                    uploadPrompt.classList.add('hidden');
                    extractBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            }
        }

        // Reset Handler
        resetBtn.addEventListener('click', () => {
            base64Image = null;
            fileInput.value = '';
            previewContainer.classList.add('hidden');
            uploadPrompt.classList.remove('hidden');
            extractBtn.disabled = true;
            resultCard.classList.add('hidden');
            outputText.value = '';
        });

        // Copy Handler
        copyBtn.addEventListener('click', () => {
            outputText.select();
            document.execCommand('copy');
            showToast("Teks berhasil disalin ke clipboard!");
        });

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            toast.classList.remove('translate-y-20');
            setTimeout(() => toast.classList.add('translate-y-20'), 3000);
        }

        // AI Extraction Logic
        extractBtn.addEventListener('click', async () => {
            if (!base64Image) return;

            resultCard.classList.remove('hidden');
            loadingState.classList.remove('hidden');
            outputText.classList.add('hidden');
            extractBtn.disabled = true;

            const prompt = "Lakukan OCR pada gambar ini. Ekstrak semua teks yang ada dengan sangat akurat. Pertahankan format paragraf atau daftar jika ada. Jangan berikan penjelasan tambahan, cukup berikan teks hasil ekstraksinya saja.";

            let retries = 5;
            let delay = 1000;

            async function callGemini() {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [
                                    { text: prompt },
                                    { inlineData: { mimeType: "image/png", data: base64Image } }
                                ]
                            }]
                        })
                    });

                    if (!response.ok) throw new Error('API Error');

                    const data = await response.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (text) {
                        displayResult(text);
                    } else {
                        throw new Error('No content received');
                    }

                } catch (error) {
                    if (retries > 0) {
                        setTimeout(callGemini, delay);
                        delay *= 2;
                        retries--;
                    } else {
                        loadingState.classList.add('hidden');
                        showToast("Gagal mengekstrak teks. Coba lagi nanti.");
                        extractBtn.disabled = false;
                    }
                }
            }

            callGemini();
        });

        function displayResult(text) {
            loadingState.classList.add('hidden');
            outputText.classList.remove('hidden');
            outputText.value = text.trim();
            extractBtn.disabled = false;
            showToast("Ekstraksi selesai!");
        }
    </script>
</body>
</html>
